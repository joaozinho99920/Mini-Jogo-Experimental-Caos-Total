<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mini Jogo Experimental Caos Total</title>
<style>
    body {margin:0; overflow:hidden; touch-action:none; background:#000; font-family:sans-serif;}
    canvas {display:block;}
    #score {
        position:absolute;
        top:20px; left:50%;
        transform:translateX(-50%);
        color:#0ff; font-size:24px; text-shadow:0 0 10px #0ff;
    }
    #restart {
        position:absolute;
        top:70%; left:50%;
        transform:translateX(-50%);
        padding:15px 30px;
        font-size:24px;
        background:#0ff;
        color:#000;
        border:none;
        border-radius:10px;
        display:none;
    }
</style>
</head>
<body>
<div id="score">Pontuação: 0</div>
<button id="restart">REINICIAR</button>
<canvas id="gameCanvas"></canvas>
<audio id="popSound" src="https://www.soundjay.com/buttons/sounds/button-16.mp3" preload="auto"></audio>
<audio id="collectSound" src="https://www.soundjay.com/buttons/sounds/button-09.mp3" preload="auto"></audio>
<audio id="bgMusic" src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" loop preload="auto"></audio>
<script>
const canvas=document.getElementById("gameCanvas");
const ctx=canvas.getContext("2d");
const popSound=document.getElementById("popSound");
const collectSound=document.getElementById("collectSound");
const bgMusic=document.getElementById("bgMusic");
const scoreDisplay=document.getElementById("score");
const restartBtn=document.getElementById("restart");

function resizeCanvas(){canvas.width=window.innerWidth; canvas.height=window.innerHeight;}
window.addEventListener("resize",resizeCanvas);
resizeCanvas();

// --- Jogador ---
const player={
    x:canvas.width/2,
    y:canvas.height/2,
    radius:25,
    color:"cyan",
    speed:16,
    targetX:canvas.width/2,
    targetY:canvas.height/2,
    moving:false
};

// --- Trailing & Particles ---
const trail=[];
const particles=[];

// --- Obstáculos ---
const obstacles=[];
const obstacleCount=8;

// --- Colecionáveis ---
const collectibles=[];
const collectibleCount=5;

// --- Power-ups ---
const powerups=[];
const powerupTypes=["speed","shrink","doublePoints"];

// --- Pontuação & Nível ---
let score=0;
let gameOver=false;
let lastTime=Date.now();
let level=1;
let pointsMultiplier=1;

// --- Função cores aleatórias ---
function randomColor(){const r=Math.floor(Math.random()*256); const g=Math.floor(Math.random()*256); const b=Math.floor(Math.random()*256); return `rgb(${r},${g},${b})`;}

// --- Inicializa obstáculos ---
function initObstacles(){
    obstacles.length=0;
    for(let i=0;i<obstacleCount;i++){
        obstacles.push({
            x:Math.random()*canvas.width,
            y:Math.random()*canvas.height,
            radius:20 + Math.random()*20,
            color:randomColor(),
            vx:(Math.random()-0.5)*(2+level),
            vy:(Math.random()-0.5)*(2+level)
        });
    }
}
initObstacles();

// --- Inicializa colecionáveis ---
function initCollectibles(){
    collectibles.length=0;
    for(let i=0;i<collectibleCount;i++){
        collectibles.push({
            x:Math.random()*(canvas.width-40)+20,
            y:Math.random()*(canvas.height-40)+20,
            radius:12,
            color:"yellow"
        });
    }
}
initCollectibles();

// --- Inicializa power-ups ---
function spawnPowerup(){
    const type=powerupTypes[Math.floor(Math.random()*powerupTypes.length)];
    powerups.push({
        x:Math.random()*(canvas.width-40)+20,
        y:Math.random()*(canvas.height-40)+20,
        radius:15,
        type:type,
        color:type==="speed"?"lime":type==="shrink"?"magenta":"orange",
        timer:0
    });
}

// --- Jogador ---
function drawPlayer(){
    ctx.beginPath();
    ctx.arc(player.x,player.y,player.radius,0,Math.PI*2);
    ctx.fillStyle=player.color;
    ctx.shadowColor="#0ff";
    ctx.shadowBlur=20;
    ctx.fill();
    ctx.closePath();
}
function updatePlayer(){
    if(player.moving){
        let dx=player.targetX-player.x;
        let dy=player.targetY-player.y;
        let distance=Math.sqrt(dx*dx+dy*dy);
        if(distance>player.speed){player.x+=dx/distance*player.speed; player.y+=dy/distance*player.speed;}
        else{player.x=player.targetX; player.y=player.targetY;}
        player.x=Math.max(player.radius, Math.min(canvas.width-player.radius, player.x));
        player.y=Math.max(player.radius, Math.min(canvas.height-player.radius, player.y));
        trail.push({x:player.x, y:player.y, alpha:1, color:randomColor()});
    }
}

// --- Trail ---
function drawTrail(){
    for(let i=0;i<trail.length;i++){
        const t=trail[i];
        ctx.beginPath();
        ctx.arc(t.x,t.y,player.radius*0.6,0,Math.PI*2);
        ctx.fillStyle=`rgba(${t.color.match(/\d+/g).join(',')},${t.alpha})`;
        ctx.fill();
        ctx.closePath();
        t.alpha-=0.03;
        if(t.alpha<=0) trail.splice(i,1);
    }
}

// --- Partículas ---
function createParticles(x,y){
    for(let i=0;i<25;i++){
        particles.push({x:x,y:y,vx:(Math.random()-0.5)*8,vy:(Math.random()-0.5)*8,alpha:1,radius:Math.random()*8+2,color:randomColor()});
    }
}
function updateParticles(){for(let i=0;i<particles.length;i++){let p=particles[i]; p.x+=p.vx; p.y+=p.vy; p.alpha-=0.03; if(p.alpha<=0) particles.splice(i,1);}}
function drawParticles(){for(let p of particles){ctx.beginPath();ctx.arc(p.x,p.y,p.radius,0,Math.PI*2);ctx.fillStyle=`rgba(${p.color.match(/\d+/g).join(',')},${p.alpha})`;ctx.fill();ctx.closePath();}}

// --- Obstáculos ---
function updateObstacles(){
    for(let o of obstacles){
        o.x+=o.vx; o.y+=o.vy;
        if(o.x<o.radius || o.x>canvas.width-o.radius) o.vx*=-1;
        if(o.y<o.radius || o.y>canvas.height-o.radius) o.vy*=-1;
        let dx=player.x-o.x; let dy=player.y-o.y;
        let distance=Math.sqrt(dx*dx+dy*dy);
        if(distance<player.radius+o.radius) gameOver=true;
    }
}
function drawObstacles(){
    for(let o of obstacles){
        ctx.beginPath();
        ctx.arc(o.x,o.y,o.radius,0,Math.PI*2);
        ctx.fillStyle=o.color;
        ctx.shadowColor=o.color; ctx.shadowBlur=15;
        ctx.fill(); ctx.closePath();
    }
}

// --- Colecionáveis ---
function updateCollectibles(){
    for(let i=0;i<collectibles.length;i++){
        let c=collectibles[i];
        let dx=player.x-c.x; let dy=player.y-c.y;
        let distance=Math.sqrt(dx*dx+dy*dy);
        if(distance<player.radius+c.radius){
            score+=10*pointsMultiplier;
            createParticles(c.x,c.y);
            collectSound.currentTime=0; collectSound.play();
            collectibles.splice(i,1);
            collectibles.push({x:Math.random()*(canvas.width-40)+20,y:Math.random()*(canvas.height-40)+20,radius:12,color:"yellow"});
        }
    }
}
function drawCollectibles(){
    for(let c of collectibles){
        ctx.beginPath();
        ctx.arc(c.x,c.y,c.radius,0,Math.PI*2);
        ctx.fillStyle=c.color; ctx.shadowColor="#ff0"; ctx.shadowBlur=10; ctx.fill(); ctx.closePath();
    }
}

// --- Power-ups ---
function updatePowerups(){
    for(let i=0;i<powerups.length;i++){
        let p=powerups[i];
        let dx=player.x-p.x; let dy=player.y-p.y;
        let distance=Math.sqrt(dx*dx+dy*dy);
        if(distance<player.radius+p.radius){
            createParticles(p.x,p.y);
            collectSound.currentTime=0; collectSound.play();
            if(p.type==="speed") player.speed+=5; 
            else if(p.type==="shrink") player.radius=Math.max(15,player.radius-5);
            else if(p.type==="doublePoints") pointsMultiplier=2;
            powerups.splice(i,1);
        } else {
            p.timer+=1;
            if(p.timer>600) powerups.splice(i,1);
        }
    }
}
function drawPowerups(){
    for(let p of powerups){
        ctx.beginPath();
        ctx.arc(p.x,p.y,p.radius,0,Math.PI*2);
        ctx.fillStyle=p.color; ctx.shadowColor=p.color; ctx.shadowBlur=15; ctx.fill(); ctx.closePath();
    }
}

// --- Eventos ---
function startMove(event){
    if(gameOver) return;
    bgMusic.play();
    event.preventDefault();
    player.moving=true;
    movePlayer(event);
    let x,y;
    if(event.touches){x=event.touches[0].clientX;y=event.touches[0].clientY;}
    else{x=event.clientX;y=event.clientY;}
    createParticles(x,y);
    popSound.currentTime=0; popSound.play();
}
function movePlayer(event){
    let rect=canvas.getBoundingClientRect();
    let x,y;
    if(event.touches){x=event.touches[0].clientX-rect.left;y=event.touches[0].clientY-rect.top;}
    else{x=event.clientX-rect.left;y=event.clientY-rect.top;}
    player.targetX=x; player.targetY=y;
}
function stopMove(event){player.moving=false;}
canvas.addEventListener("mousedown",startMove);
canvas.addEventListener("mousemove",movePlayer);
canvas.addEventListener("mouseup",stopMove);
canvas.addEventListener("touchstart",startMove);
canvas.addEventListener("touchmove",movePlayer);
canvas.addEventListener("touchend",stopMove);

// --- Fundo psicodélico ---
let gradientOffset=0;
function drawBackground(){
    gradientOffset+=2;
    const grad=ctx.createLinearGradient(0,gradientOffset,canvas.width,canvas.height+gradientOffset);
    grad.addColorStop(0,`hsl(${(gradientOffset)%360},90%,20%)`);
    grad.addColorStop(1,`hsl(${(gradientOffset+180)%360},90%,20%)`);
    ctx.fillStyle=grad;
    ctx.fillRect(0,0,canvas.width,canvas.height);
}

// --- Loop principal ---
function gameLoop(){
    if(gameOver){
        ctx.fillStyle="rgba(0,0,0,0.7)"; ctx.fillRect(0,0,canvas.width,canvas.height);
        ctx.fillStyle="#ff0044"; ctx.font="50px sans-serif"; ctx.textAlign="center";
        ctx.fillText("GAME OVER",canvas.width/2,canvas.height/2);
        ctx.font="30px sans-serif"; ctx.fillText(`Pontuação: ${Math.floor(score)}`,canvas.width/2,canvas.height/2+50);
        restartBtn.style.display="block";
        return;
    }

    // Pontuação e nível
    let now=Date.now();
    score+=(now-lastTime)/1000*pointsMultiplier; lastTime=now;
    scoreDisplay.textContent=`Pontuação: ${Math.floor(score)}`;
    level=Math.floor(score/30)+1;
    player.speed=16+level;

    drawBackground();
    updatePlayer(); drawTrail(); updateParticles(); drawParticles();
    updateObstacles(); drawObstacles();
    updateCollectibles(); drawCollectibles();
    updatePowerups(); drawPowerups();
    drawPlayer();

    // Spawn aleatório power-ups
    if(Math.random()<0.005) spawnPowerup();

    requestAnimationFrame(gameLoop);
}
gameLoop();

// --- Reiniciar ---
restartBtn.addEventListener("click",()=>{
    gameOver=false; score=0; lastTime=Date.now(); pointsMultiplier=1; player.radius=25;
    initObstacles(); initCollectibles(); powerups.length=0; restartBtn.style.display="none"; gameLoop();
});

</script>
</body>
</html>
